name: Norminette CI

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  norminette:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'

      - name: Install Norminette
        run: pip install norminette

      - name: Run Norminette
        id: norminette
        run: norminette ./src/
        continue-on-error: true

      - name: Create status badge
        if: always()
        run: |
          if [ "${{ steps.norminette.outcome }}" == "success" ]; then
            echo "![Norminette](https://img.shields.io/badge/Norminette-passing-brightgreen)" > badge.md
          else
            echo "![Norminette](https://img.shields.io/badge/Norminette-failing-red)" > badge.md
          fi

      - name: Upload status badge
        if: always()
        uses: actions/upload-artifact@v2
        with:
          name: badge
          path: badge.md
